var translations={};function get_translation(e){return e in translations?translations[e]:e}function form_is_valid(e){var t=!0;return e.find(".validate").each((function(){$(this).hasClass("valid")||(t=!1)})),t}function show_error_message(e,t){var a=get_translation(t),r=$("<p></p>");r.addClass("error-message"),r.attr("for",e.attr("name")),r.text(a),e.parents("fieldset").after(r),setTimeout((function(){r.remove(300)}),1e4),r.click((function(){r.remove(300),e.focus()}))}function check_not_empty(e){if(null!=e.attr("empty"))return!0;if("file"==e.attr("type"))return 0!=e.prop("files").length||(show_error_message(e,"empty_input_field"),!1);var t=e.val();return""!=(t=t.trim())||(show_error_message(e,"empty_input_field"),!1)}function check_must_be_equal_to(e){if(null!=e.attr("must_be_equal_to")&&e.val()!=e.attr("must_be_equal_to"))return show_error_message(e,"must_be_equal_to"),!1;return!0}function check_in_group(e){if(null!=e.attr("in-group")){var t=e.val();let a="/validate/"+e.attr("in-group"),r={candidate:t},i=!1;return $.ajax({url:a,method:"POST",data:r,async:!1,success:function(t){i=t.valid,0==t.valid&&show_error_message(e,"not_in_group")}}),i}return!0}function check_not_in_group(e){if(null!=e.attr("not-in-group")){var t=e.val();let a="/validate/"+e.attr("not-in-group"),r={candidate:t},i=!1;return $.ajax({url:a,method:"POST",data:r,async:!1,success:function(t){i=!t.valid,t.valid&&show_error_message(e,"in_group")}}),i}return!0}function check_mime_type(e){if(null!=e.attr("mime-type"))for(var t=e.prop("files"),a=e.attr("mime-type").split(","),r=0;r<t.length;r++){var i=t[r].type;if(-1==a.indexOf(i))return show_error_message(e,"invalid_mime_type"),!1}return!0}function validation_callback(e){if(null==e.attr("last-validated-value")||""==e.attr("last-validated-value")||e.attr("last-validated-value")!=e.val()){$('p.error-message[for="'+e.attr("name")+'"]').remove(),e.attr("last-validated-value",e.val());var t=$('label[for="'+e.attr("name")+'"]');check_not_empty(e)&&check_must_be_equal_to(e)&&check_in_group(e)&&check_not_in_group(e)&&check_mime_type(e)?(e.removeClass("error"),t.removeClass("error"),e.addClass("valid"),t.addClass("valid")):(e.removeClass("valid"),t.removeClass("valid"),e.addClass("error"),t.addClass("error")),e.parents("form").find('button[type="submit"]').prop("disabled",!form_is_valid(e.parents("form")))}}var timeout=null;function timed_validation_callback(e){timeout&&clearTimeout(timeout),timeout=setTimeout((function(){validation_callback(e)}),300)}$(document).ready((function(){$(".validate").blur((function(){"file"!=$(this).attr("type")&&timed_validation_callback($(this))})),$(".validate").keyup((function(){timed_validation_callback($(this))})),$("form").each((function(){var e=$(this);form_is_valid(e)||e.find('button[type="submit"]').prop("disabled",!0)})),$("form").submit((function(e){if(e.preventDefault(),form_is_valid($(this))){var t=$(this),a=t.attr("action"),r=t.attr("method");$.ajax({url:a,method:r,data:new FormData(this),contentType:!1,cache:!1,processData:!1,beforeSend:function(){t.find('button[type="submit"]').prop("disabled",!0),t.find(".show-before-send").show(300),t.find(".hide-before-send").hide(300)},complete:function(){t.find('button[type="submit"]').prop("disabled",!1),setTimeout((function(){t.find(".show-before-send").hide(300),t.find(".hide-before-send").show(300)}),3e3)},xhr:function(){if(0==t.find(".progress-bar").length)return null;var e=new window.XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=e.loaded/e.total*100;$(".progress-bar").width(t+"%");let a=Math.round(t);$(".completion-percentage").html(a+"%")}}),!1),e},success:function(e){if(t.find("input").val(""),t.find("textarea").val(""),t.find("input").removeClass("valid"),t.find("textarea").removeClass("valid"),t.find("label.valid").removeClass("valid"),t.find("label.dropzone").removeClass("dropped"),"redirect_url"in e){var a=e.redirect_url;window.location.replace(a)}},error:function(e){for(var a=e.errors,r=0;r<a;r++){var i=a[r];show_error_message(t.find('input[name="'+i.field+'"]'),i.message)}}})}})),$("label.dropzone").each((function(){var e=$(this),t=e.find('input[type="file"]');e.on("drop",(function(a){a.preventDefault(),a.stopPropagation(),e.removeClass("dragover");var r=a.originalEvent.dataTransfer.files;t.prop("files",r),e.addClass("dropped"),t.hasClass("validate")&&timed_validation_callback(t)})),t.change((function(){t.prop("files").length>0?e.addClass("dropped"):e.removeClass("dropped"),t.hasClass("validate")&&timed_validation_callback(t)})),e.on("dragover",(function(t){t.preventDefault(),t.stopPropagation(),e.addClass("dragover")})),e.on("dragout",(function(t){t.preventDefault(),t.stopPropagation(),e.removeClass("dragover")}))}))}));